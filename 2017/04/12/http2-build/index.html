<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Nginx 开启 HTTP/2 · krasie's blog</title><meta name="description" content="Nginx 开启 HTTP/2 - krasie"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://krasie.github.io/atom.xml" title="krasie's blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/gaoguancong" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/krasie" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Nginx 开启 HTTP/2</h1><div class="post-info">Apr 12, 2017</div><div class="post-content"><p>随着 HTTPS/2 的普及，越来越多网站开启了 HTTPS/2 ，上个月也把自己的网站升级上了 HTTPS/2 。</p>
<a id="more"></a>
<h4 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h4><ol>
<li>要开启 HTTP/2 需要 Nginx 版本在 1.10.0 以上且需要 openssl 版本在 1.0.2 以上编译。</li>
<li>HTTP/2 只支持开启了 https 的网站</li>
</ol>
<p>服务器安装的版本刚好都符合要求，所以就直接设置好了 ssl 证书。</p>
<h4 id="配置-HTTP-2"><a href="#配置-HTTP-2" class="headerlink" title="配置 HTTP/2"></a>配置 HTTP/2</h4><p>配置 Nginx 开启 HTTP/2 特别简单，只要在 Nginx 配置文件中找到你要开启 HTTP/2 的域名 server 模块，然后将 <code>listen 443 ssl;</code> 改成 <code>listen 443 ssl http2;</code> 即可。</p>
<p>要优化nginx配置可以用 <a href="https://mozilla.github.io/server-side-tls/ssl-config-generator/" target="_blank" rel="noopener">https://mozilla.github.io/server-side-tls/ssl-config-generator/</a> 这个生成的配置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line"></span><br><span class="line">	listen 443 ssl http2;</span><br><span class="line">	server_name domain.com;</span><br><span class="line"></span><br><span class="line">	ssl_certificate /path/to/public.crt;</span><br><span class="line">	ssl_certificate_key /path/to/private.key;</span><br><span class="line">	</span><br><span class="line">	ssl_protocols TLSv1 TLSv1.1 TLSv1.2; #允许的协议 </span><br><span class="line">	ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5; #加密算法(CloudFlare 推荐的加密套件组) </span><br><span class="line">	ssl_prefer_server_ciphers on; #优化 SSL 加密套件 </span><br><span class="line">	ssl_session_timeout 10m; #客户端会话缓存时间 </span><br><span class="line">	ssl_session_cache builtin:1000 shared:SSL:10m; #SSL 会话缓存类型和大小 </span><br><span class="line">	ssl_buffer_size 1400; # 1400 bytes to fit in one MTU</span><br></pre></td></tr></table></figure></div></article></div></main><footer><div class="paginator"><a href="/2017/11/04/charles-https/" class="prev">PREV</a><a href="/2016/12/07/linux-security/" class="next">NEXT</a></div><div class="copyright"><p>© 2017 <a href="http://krasie.github.io">krasie</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>